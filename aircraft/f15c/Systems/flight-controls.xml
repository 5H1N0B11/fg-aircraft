<system  name="FCS F15">

        <property>fcs/hook-engage</property>
        <property>fcs/flap-cmd-sum</property>
        <property>fcs/roll-trim-sas-cmd-norm</property>


        <channel name="Pitch">

            <summer name="Pitch Trim Sum">
                <input>fcs/elevator-cmd-norm</input>
                <input>fcs/pitch-trim-cmd-norm</input>
                <input>fcs/pitch-damper-rate</input>
                <input>systems/afcs/elevator-cmd-delta</input>
                <clipto>
                    <min> -1 </min>
                    <max>  1 </max>
                </clipto>
            </summer>

            <switch name="position/aircraft-on-ground">
                <description>Aircraft on ground</description>
                <default value="0"/>
                <test value="1" logic="OR">
                    gear/unit[0]/WOW ne 0
                    gear/unit[1]/WOW ne 0
                    gear/unit[2]/WOW ne 0
                </test>
            </switch>

            <switch name="fcs/pitch-trim-actuator">
                <default value="fcs/pitch-trim-sum"/>
                <test value="fcs/pitch-trim-actuator">
                    systems/hydraulics/flight-system-pressure ne 1
                </test>
            </switch>
            
            <aerosurface_scale name="Elevator Control">
                <input>fcs/pitch-trim-actuator</input>
                <!-- maybe this should take into account the trim limits from the AAP -->
                <range>
                    <min> -0.57895 </min>
                    <max>  0.2105 </max>
                </range>
                <output>fcs/elevator-pos-demand</output>
            </aerosurface_scale>


            <!-- F14a stabilizer: +/- 7deg : +/- 30 deg/sec -->
            <kinematic name="elevator position">
                <input>fcs/elevator-pos-demand</input>
                <traverse>
                    <setting>
                        <position>-1</position>
                        <time>1.75</time>
                    </setting>
                    <setting>
                        <position>1</position>
                        <time>0.90</time>
                        <!-- based on 30 deg/sec -->
                    </setting>
                </traverse>
                <output>fcs/elevator-pos-rad</output>
            </kinematic>

            <aerosurface_scale name="Differential elevator">
                <input>fcs/roll-trim-sum</input>
                <domain>
                    <min>  -1 </min>
                    <max>   1 </max>
                </domain>
                <range>
                    <min> -6 </min>
                    <max>  6 </max>
                </range>
                <output>fcs/differential-elevator-pos-deg</output>
            </aerosurface_scale>

    <aerosurface_scale name="Differential elevator">
                <input>fcs/roll-trim-sum</input>
                <domain>
                    <min>  -1 </min>
                    <max>   1 </max>
                </domain>
                <range>
                    <min> -1 </min>
                    <max>  1 </max>
                </range>
                <gain>0.3</gain>
                <output>fcs/differential-elevator-pos-norm</output>
            </aerosurface_scale>

            <summer name="Left elevator normalization">
                <input>fcs/elevator-pos-deg</input>
                <input>fcs/left-aileron-pos-deg</input>
                <output>fcs/left-elevator-pos-deg</output>
            </summer>
            <summer name="Right elevator normalization">
                <input>fcs/elevator-pos-deg</input>
                <input>-fcs/right-aileron-pos-deg</input>
                <output>fcs/right-elevator-pos-deg</output>
            </summer>

            <aerosurface_scale name="elevator normalization">
                <input>fcs/elevator-pos-rad</input>
                <domain>
                    <min>  -0.57895 </min>
                    <max>   0.21053 </max>
                </domain>
                <range>
                    <min> -1 </min>
                    <max>  1 </max>
                </range>
                <output>fcs/elevator-pos-norm</output>
            </aerosurface_scale>

        </channel>

        <property>systems/NWS/engaged</property>

        <channel name="Nose Wheel Steering">
            <switch name="systems/NWS/engaged">
                <default value="0"/>
                <test value="1">
                    gear/unit[0]/wheel-speed-fps le 135
                    systems/hydraulics/combined-system-pressure ne 0
                    position/aircraft-on-ground ne 0
                    systems/holdback/launchbar-engaged eq 0
                </test>
                <output>systems/NWS/engaged</output>
            </switch>

            <scheduled_gain name="fcs/scheduled-steer-pos-deg">
                <input>fcs/steer-cmd-norm</input>
                <table>
                    <independentVar lookup="row">gear/unit[0]/wheel-speed-fps</independentVar>
                    <independentVar lookup="column">systems/NWS/engaged</independentVar>
                    <tableData>
                            0   1
                        0   0   87
                        80  0   15
                        135 0   0
                    </tableData>
                </table>
                <output>fcs/steer-pos-deg</output>
            </scheduled_gain>
        </channel>

        <channel name="SoundFX">
            <fcs_function name="fcs/flap-windfx-volume">
                <function>
                    <product>
                        <property>velocities/ve-kts</property>
                        <property>fcs/flap-pos-norm</property>
                    </product>
                </function>
                <output>fcs/flap-windfx-volume</output>
            </fcs_function>
            <fcs_function name="fcs/gear-windfx-volume">
                <function>
                    <product>
                        <property>velocities/ve-kts</property>
                        <property>fcs/gear-control</property>
                    </product>
                </function>
                <output>fcs/gear-windfx-volume</output>
            </fcs_function>
        </channel>

        <!-- aileron: +/- 5deg : +/- 33 deg/sec -->
        <channel name="Roll">
            <summer name="Roll Trim Sum">
                <input>fcs/aileron-cmd-norm</input>
                <input>fcs/roll-trim-cmd-norm</input>
                <input>fcs/roll-trim-sas-cmd-norm</input>
                <input>fcs/roll-rate-limiter</input>
                <clipto>
                    <min> -1 </min>
                    <max>  1 </max>
                </clipto>
            </summer>

            <switch name="fcs/roll-trim-actuator">
                <default value="fcs/roll-trim-sum"/>
                <test value="fcs/roll-trim-actuator">
                    systems/hydraulics/flight-system-pressure ne 1
                </test>
            </switch>
            <aerosurface_scale name="Aileron Control">
                <input>fcs/roll-trim-actuator</input>
                <range>
                    <min> -0.22807 </min>
                    <max>  0.22807 </max>
                </range>
                <output>fcs/aileron-pos-rad</output>
            </aerosurface_scale>

    <aerosurface_scale name="Left Aileron Control">
                <input>fcs/roll-trim-actuator</input>
                <range>
                    <min> -0.22807 </min>
                    <max>  0.22807 </max>
                </range>
                <output>fcs/left-aileron-pos-rad</output>
            </aerosurface_scale>

            <aerosurface_scale name="Right Aileron Control">
                <input>fcs/roll-trim-actuator</input>
                <range>
                    <min> -0.22807 </min>
                    <max>  0.22807 </max>
                </range>
                <output>fcs/right-aileron-pos-rad</output>
            </aerosurface_scale>

               <aerosurface_scale name="left aileron normalization">
                <input>fcs/left-aileron-pos-rad</input>
                <domain>
                    <min> -0.22807 </min>
                    <max>  0.22807 </max>
                </domain>
                <range>
                    <min> -1 </min>
                    <max>  1 </max>
                </range>
                <output>fcs/left-aileron-pos-norm</output>
            </aerosurface_scale>

            <aerosurface_scale name="right aileron normalization">
                <input>fcs/right-aileron-pos-rad</input>
                <domain>
                    <min> -0.22807 </min>
                    <max>  0.22807 </max>
                </domain>
                <range>
                    <min> -1 </min>
                    <max>  1 </max>
                </range>
                <output>fcs/right-aileron-pos-norm</output>
            </aerosurface_scale>
        
    <aerosurface_scale name="Aileron Control">
                <input>fcs/roll-trim-actuator</input>
                <range>
                    <min> -6 </min>
                    <max>  6</max>
                </range>
                <output>fcs/aileron-pos-deg</output>
            </aerosurface_scale>


            <aerosurface_scale name="aileron normalization">
                <input>fcs/aileron-pos-rad</input>
                <domain>
                    <min> -0.22807 </min>
                    <max>  0.22807 </max>
                </domain>
                <range>
                    <min> -1 </min>
                    <max>  1 </max>
                </range>
                <output>fcs/aileron-norm</output>
            </aerosurface_scale>
        </channel>

        <property value="0">fcs/yaw-damper-enable</property>
        <property value="0">fcs/pitch-damper-enable</property>
        <property value="0">fcs/roll-sas-enable</property>
        <property value="0">fcs/external-tanks-fitted</property>
        <property value="0">fcs/aim-fitted</property>
        <channel name="Yaw">

            <!-- yaw damper only active when in range alpha +/10 deg -->
            <switch name="fcs/yaw-damper-active">
                <default value="0.0"/>
                <test logic="AND" value="1">
                    aero/alpha-rad ge -0.175438596491228
                    aero/alpha-rad le  0.175438596491228
                    fcs/yaw-damper-enable ne 0.0
                </test>
                <output>fcs/yaw-damper-active</output>
            </switch>

            <switch name="fcs/roll-sas-active">
                <default value="0.0"/>
                <test logic="AND" value="1">
                    aero/alpha-rad ge -0.175438596491228
                    aero/alpha-rad le  0.2631578947368421
                    fcs/roll-sas-enable ne 0.0
                </test>
                <output>fcs/roll-sas-active</output>
            </switch>
            <!-- rudder limits +/-30deg 40 deg/sec-->
            <!-- stabilizer limits +/7deg 30 deg/sec-->

            <pure_gain name="Pilot G">
                <input>accelerations/n-pilot-z-norm</input>
                <gain>-1</gain>
                <output>/accelerations/pilot-gdamped</output>
            </pure_gain>

            <scheduled_gain name="Yaw Damper Rate">
                <input>velocities/r-aero-rad_sec</input>
                <table>
                    <independentVar lookup="row">velocities/ve-kts</independentVar>
                    <tableData>
                        30     0.00
                        60     2.00
                    </tableData>
                </table>
                <gain>fcs/yaw-damper-active</gain>
            </scheduled_gain>

            <switch name="fcs/pitch-damper-active">
                <default value="0.0"/>
                <test logic="AND" value="1">
                    aero/alpha-rad ge -0.175438596491228
                    aero/alpha-rad le  0.2631578947368421
                    fcs/elevator-cmd-norm ge -0.15
                    fcs/elevator-cmd-norm le 0.15
                    fcs/pitch-damper-enable ne 0.0
                </test>
                <output>fcs/pitch-damper-active</output>
            </switch>

            <scheduled_gain name="Pitch Damper Rate">
                <!-- Figure 2-57 F14AAD-1  -->
                <input>velocities/q-aero-rad_sec</input>
                <table>
                    <independentVar lookup="row">velocities/ve-kts</independentVar>
                    <tableData>
                        30     0.00
                        60     1
                    </tableData>
                </table>
                <gain>fcs/pitch-damper-active</gain>
                <min> -0.2857142857142857 </min>
                <max>  0.2857142857142857 </max>
            </scheduled_gain>

            <scheduled_gain name="fcs/roll-rate-limiter">
                <input>fcs/aileron-cmd-norm</input>
                <table>
                    <independentVar lookup="row">velocities/p-aero-rad_sec</independentVar>
                    <tableData>
                        -6.2    -1.0
                        -1.4     0.0
                        1.4     0.0
                        6.2    -1.0
                    </tableData>
                </table>
                <gain>fcs/roll-sas-active</gain>
            </scheduled_gain>


            <summer name="Rudder Command Sum">
                <input>fcs/rudder-cmd-norm</input>
                <input>fcs/yaw-trim-cmd-norm</input>
                <clipto>
                    <min> -1 </min>
                    <max>  1 </max>
                </clipto>
            </summer>

            <summer name="Rudder Sum">
                <input>fcs/rudder-command-sum</input>
                <input>fcs/yaw-damper-rate</input>
                <clipto>
                    <min> -1.1 </min>
                    <max>  1.1 </max>
                </clipto>
            </summer>

            <switch name="fcs/rudder-actuator-pos">
                <default value="fcs/rudder-sum"/>
                <test value="fcs/rudder-actuator-pos">
                    systems/hydraulics/flight-system-pressure ne 1
                </test>
            </switch>
            <kinematic name="Rudder Control">
                <input>fcs/rudder-actuator-pos</input>
                <traverse>
                    <setting>
                        <position>-0.35</position>
                        <time>0.90</time>
                        <!-- based on 30 deg/sec -->
                    </setting>
                    <setting>
                        <position>0.35</position>
                        <time>0.90</time>
                        <!-- based on 30 deg/sec -->
                    </setting>
                </traverse>
                <output>fcs/rudder-pos-rad</output>
            </kinematic>

            <aerosurface_scale name="rudder normalization">
                <input>fcs/rudder-pos-rad</input>
                <domain>
                    <min> -0.35 </min>
                    <max>  0.35 </max>
                </domain>
                <range>
                    <min> -1 </min>
                    <max>  1 </max>
                </range>
                <output>fcs/rudder-pos-norm</output>
            </aerosurface_scale>


        </channel>

        <channel name="Flaps">

            <switch name="fcs/flap-total-dmd">
                <default value="0"/>
                <test value="fcs/flap-total-dmd">
                    systems/hydraulics/combined-system-pressure ne 1
                </test>
                <test value="fcs/flap-cmd-norm">
                    fcs/flap-cmd-norm ne 0
                    systems/hydraulics/combined-system-pressure ne 0
                </test>
                <test value="systems/cadc/manuv-flap-extension-cmd">
                    systems/cadc/manuv-flap-extension-cmd ne 0
                    systems/hydraulics/combined-system-pressure ne 0
                </test>
                <clipto>
                    <min> 0 </min>
                    <max>  1 </max>
                </clipto>
                <output>fcs/flap-total-dmd</output>
            </switch>

            <kinematic name="Flaps Control">
                <input>fcs/flap-total-dmd</input>
                <traverse>
                    <setting>
                        <position>  0 </position>
                        <time>      0 </time>
                    </setting>
                    <setting>
                        <position> 30 </position>
                        <time>    1.9 </time>
                    </setting>
                </traverse>
                <output>fcs/flap-pos-deg</output>
            </kinematic>

            <aerosurface_scale name="flap normalization">
                <input>fcs/flap-pos-deg</input>
                <domain>
                    <min>  0 </min>
                    <max> 30 </max>
                </domain>
                <range>
                    <min> 0 </min>
                    <max> 1 </max>
                </range>
                <output>fcs/flap-pos-norm</output>
            </aerosurface_scale>


        </channel>

        <channel name="Landing Gear">
            <switch name="gear/gear-dmd-norm">
                <default value="1"/>
                <test value="1">
                    <!-- always force gear down when on ground - to prevent inadvertant retraction -->
                    position/aircraft-on-ground ne 0
                </test>
                <test value="gear/gear-dmd-norm">
                    systems/hydraulics/combined-system-pressure ne 1
                </test>
                <test value="gear/gear-cmd-norm">
                    systems/hydraulics/combined-system-pressure ne 0
                </test>
                <clipto>
                    <min> 0 </min>
                    <max>  1 </max>
                </clipto>
                <output>gear/gear-dmd-norm</output>
            </switch>
            <kinematic name="Gear Control">
                <input>gear/gear-dmd-norm</input>
                <traverse>
                    <setting>
                        <position> 0 </position>
                        <time>     0 </time>
                    </setting>
                    <setting>
                        <position> 1 </position>
                        <time>     5 </time>
                    </setting>
                </traverse>
                <output>gear/gear-pos-norm</output>
            </kinematic>

        </channel>

        <channel name="Speedbrake">
            <switch name="fcs/speedbrake-dmd-norm">
                <default value="0"/>
                <test value="fcs/speedbrake-dmd-norm">
                    systems/hydraulics/combined-system-pressure ne 1
                </test>
                <test value="fcs/speedbrake-cmd-norm">
                    systems/hydraulics/combined-system-pressure ne 0
                </test>
                <clipto>
                    <min> 0 </min>
                    <max>  1 </max>
                </clipto>
                <output>fcs/speedbrake-dmd-norm</output>
            </switch>

            <kinematic name="Speedbrake Control">
                <input>fcs/speedbrake-dmd-norm</input>
                <traverse>
                    <setting>
                        <position> 0 </position>
                        <time>     0 </time>
                    </setting>
                    <!--<setting>
          <position> 0.3 </position>
          <time>     0.5 </time>
       </setting>
       <setting>
          <position> 0.6 </position>
          <time>     0.5 </time>
       </setting>-->
                    <setting>
                        <position> 1 </position>
                        <time>     1.5 </time>
                    </setting>
                </traverse>
                <output>fcs/speedbrake-pos-norm</output>
            </kinematic>
        </channel>

        <channel name="Hook">

            <kinematic name="fcs/hook-control">
                <input>fcs/hook-engage</input>
                <traverse>
                    <setting>
                        <position>0</position>
                        <time>0</time>
                    </setting>
                    <setting>
                        <position>1</position>
                        <time>2.5</time>
                    </setting>
                </traverse>
                <output>fcs/hook-pos-norm</output>
            </kinematic>

        </channel>

        <channel name="extra-aero">
            <fcs_function name="aero/alpha-indicated-deg">
                <description>ARI nose probe; ref ADA101648 p84; alpha_true = .8122 alphaNOSEPROBE + .797deg</description>
                <function>
                    <product>
                        <sum>
                            <property> aero/alpha-deg </property>
                            <value> -0.797 </value>
                        </sum>
                        <value>1.231223836</value>
                    </product>
                </function>
            </fcs_function>
            <fcs_function name="aero/aero-rp-x-in">
                <function>
                    <description>Centre of pressure due to mach</description>
                    <sum>
                        <table>
                            <independentVar lookup="row">velocities/mach</independentVar>
                            <tableData>
                                0.00    419
                                2.4     445
                            </tableData>
                        </table>
                    </sum>
                </function>
                <output>metrics/aero-rp-x-in</output>
            </fcs_function>

            <fcs_function name="aero/cadc-control-effectivity-factor">
                <function>
                    <description>High speeds CADC control effectivity limitation of rudder and elevator</description>
                    <sum>
                        <table>
                            <independentVar lookup="row">velocities/mach</independentVar>
                            <!-- mach 2.40 with wingsweep 22deg isn't in the envelope -->
                            <tableData>
                                0.00  1.0
                                1.00  0.6
                                2.40  0.3
                            </tableData>
                        </table>
                    </sum>
                </function>
            </fcs_function>

            <!-- need %Cg in chord for moments [Xcg - Xref)/100] -->
            <summer name="cg-x-offset-chord-in">
                <input> inertia/cg-x-in</input>
                <input> -metrics/aero-rp-x-in</input>
                <output>inertia/cg-x-offset-chord-in</output>
            </summer>

            <pure_gain name="cg-x-chord-percent">
                <description>Percent offset of the CoP from the CG</description>
                <input>inertia/cg-x-offset-chord-in</input>
                <gain> -0.01</gain>
                <clipto>
                    <min> -1 </min>
                    <max> 1 </max>
                </clipto>
                <output> inertia/cg-x-mac-percent </output>
            </pure_gain>

            <fcs_function name="pb">
                <description>PB Denormalization</description>
                <function>
                    <quotient>
                        <product>
                            <property>metrics/bw-ft</property>
                            <property>velocities/p-aero-rad_sec</property>
                        </product>
                        <!-- over -->
                        <product>
                            <value>2</value>
                            <property>velocities/vt-fps</property>
                        </product>
                    </quotient>
                </function>
                <clipto>
                    <min> -1.00 </min>
                    <max>  1.00 </max>
                </clipto>
                <output>aero/pb</output>
            </fcs_function>

            <fcs_function name="cbarq-2vo">
                <description>For denormalization</description>
                <function>
                    <quotient>
                        <product>
                            <property>metrics/cbarw-ft</property>
                            <property>velocities/q-aero-rad_sec</property>
                        </product>
                        <!-- over -->
                        <product>
                            <value>2</value>
                            <property>velocities/vt-fps</property>
                        </product>
                    </quotient>
                </function>
                <clipto>
                    <min> -2.01 </min>
                    <max>  2.01 </max>
                </clipto>
                <output>aero/qb</output>
            </fcs_function>
            <fcs_function name="rb-2vo">
                <description>For denormalization</description>
                <function>
                    <quotient>
                        <product>
                            <property>metrics/bw-ft</property>
                            <property>velocities/r-aero-rad_sec</property>
                        </product>
                        <!-- over -->
                        <product>
                            <value>2</value>
                            <property>velocities/vt-fps</property>
                        </product>
                    </quotient>
                </function>
                <clipto>
                    <min> -1.00 </min>
                    <max>  1.00 </max>
                </clipto>
                <output>aero/rb</output>
            </fcs_function>


            <fcs_function name="aero-cos-alpha">
                <function>
                    <product>
                        <cos>
                            <property>aero/alpha-rad</property>
                        </cos>
                    </product>
                </function>
                <output>aero/cos-alpha</output>
            </fcs_function>

            <fcs_function name="aero-sin-alpha">
                <function>
                    <product>
                        <sin>
                            <property>aero/alpha-rad</property>
                        </sin>
                    </product>
                </function>
                <output>aero/sin-alpha</output>
            </fcs_function>


        </channel>
    </system>
