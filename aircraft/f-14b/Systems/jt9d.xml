<?xml version="1.0"?>
<!--
        Description: JT8D turbine model 
        Author: Richard Harrison (rjh@zaretto.com)
        References: CR-1756 Modelling data; Chatper 12 "Propulsion system" p338
-->


<system name="JT8D">

    <property value="1.2"> systems/jt9d/engine[0]/c-epr-lag </property>
    <property value="0.8"> systems/jt9d/engine[0]/c-ff-lag </property>
    <property value="0.1"> systems/jt9d/engine[0]/c-egt-lag </property>
    <property value="16800"> systems/jt9d/engine[0]/c-milthrust-lb </property>
    <property value="27080"> systems/jt9d/engine[0]/c-maxthrust-lb </property>
    <property value="1.8119"> systems/jt9d/engine[0]/c-augthrust-factor </property>
    <property value="0.745"> systems/jt9d/engine[0]/c-tsfc </property>
    <property value="2.01">  systems/jt9d/engine[0]/c-atsfc </property>
    <property value="1.265">  systems/jt9d/engine[0]/c-atsfc-delta </property>
    <property value="0.85">  systems/jt9d/engine[0]/c-bypassratio </property>
    <property value="0.0035">  systems/jt9d/engine[0]/c-augmentation-to-egt </property>

    <property>/engines/engine[0]/oil-pressure-psi</property>
    <property>/engines/engine[1]/oil-pressure-psi</property>

    <property>propulsion/engine[0]/set-running </property>
    <property>forces/fbx-prop-lbs    </property>
    <property>propulsion/engine[0]/fuel-flow-rate-pps</property>
    <property>propulsion/engine[1]/fuel-flow-rate-pps</property>

    <property>propulsion/engine[1]/set-running </property>
    <property>propulsion/engine[0]/n1 </property>
    <property>propulsion/engine[1]/n1 </property>
    <property>propulsion/engine[0]/n2 </property>
    <property>propulsion/engine[1]/n2 </property>
    <property>propulsion/engine[0]/nozzle-pos-norm </property>
    <property>propulsion/engine[1]/nozzle-pos-norm </property>

    <property>/engines/engine[0]/afterburner</property>
    <property>/engines/engine[1]/afterburner</property>
    <property>/engines/engine[0]/augmentation</property>
    <property>/engines/engine[1]/augmentation</property>
    <property>/controls/engines/engine[0]/throttle</property>
    <property>/controls/engines/engine[1]/throttle</property>

    <property value="1">/engines/engine[0]/running </property>
    <property value="1">/engines/engine[1]/running </property>

    <property> fcs/throttle-cmd-norm[0]</property>
    <property> fcs/throttle-cmd-norm[1]</property>
    <property> fcs/throttle-pos-norm[0]</property>
    <property> fcs/throttle-pos-norm[1]</property>

    <channel name="Engine1">
        <fcs_function name="systems/jt9d/engine[0]/epr-base">
            <function>
                <description>PLA to EPR  Figure 12.1-4 CR-1756</description>
                <product>
                    <table>
                        <!--                        <independentVar lookup="row">fcs/throttle-cmd-norm[0] </independentVar> -->
                        <independentVar lookup="row">/controls/engines/engine[0]/throttle</independentVar>

                        <independentVar lookup="column">atmosphere/T-R</independentVar>
                        <tableData>
                            394.67	459.67	518.67	579.67
                            0.00	1.0 	1.0 	1.0 	1.0
                            0.01	1.05335	1.02663	1.01772	1.00881
                            0.13	1.12676	1.07328	1.04802	1.02724
                            0.20	1.18416	1.11289	1.06832	1.04308
                            0.33	1.30794	1.17426	1.11635	1.07624
                            0.47	1.42128	1.25048	1.16733	1.1109
                            0.67	1.56682	1.42128	1.29208	1.19109
                            0.74	1.56682	1.47425	1.34800	1.22921
                            0.87	1.56682	1.57723	1.44950	1.33068
                            1.00	1.56682	1.57723	1.54804	1.44851
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>

        <summer name="systems/jt9d/engine[0]/inlet-mach">
            <description>Inlet airflow mach</description>
            <input>velocities/mach</input>
            <clipto>
                <min> 0 </min>
                <max>1.0</max>
            </clipto>
        </summer>

        <fcs_function name="systems/jt9d/engine[0]/epr-mach">
            <function>
                <description>PLA~EPR Mach number effect figure 12.1-5 CR-1756</description>
                <product>
                    <table>
                        <independentVar lookup="row">systems/jt9d/engine[0]/inlet-mach</independentVar>
                        <independentVar lookup="column">position/h-sl-ft</independentVar>
                        <tableData>
                            0    	15000   	36065
                            0.0	-0.000000	-0.000000	-0.000000
                            0.1	-0.019076	-0.000000	-0.000000
                            0.2	-0.042277	-0.006561	-0.005187
                            0.3	-0.076465	-0.039377	-0.038005
                            0.4	-0.127136	-0.084554	-0.066695
                            0.6	-0.188796	-0.140721	-0.100886
                            0.7	-0.258698	-0.202380	-0.140568
                            0.8	-0.335469	-0.266787	-0.178875
                            0.9	-0.413614	-0.343558	-0.229547
                            1.0	-0.497251	-0.434064	-0.291207
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="systems/jt9d/engine[0]/epr-dmd">
            <function>
                <sum>
                    <property>systems/jt9d/engine[0]/epr-base</property>
                    <property>systems/jt9d/engine[0]/epr-mach</property>
                </sum>
            </function>
        </fcs_function>

        <lag_filter name="systems/jt9d/engine[0]/epr">
            <input> systems/jt9d/engine[0]/epr-dmd </input>
            <c1> systems/jt9d/engine[0]/c-epr-lag </c1>
        </lag_filter>

        <lag_filter name="systems/jt9d/engine[0]/epr-internal">
            <input> systems/jt9d/engine[0]/epr-base </input>
            <c1> systems/jt9d/engine[0]/c-epr-lag </c1>
        </lag_filter>

        <fcs_function name="systems/jt9d/engine[0]/n1">
            <function>
                <description>EPR ~ LPT RPM (N1)%. 100% N1 = 3600 RPM Figure 12.3.6</description>
                <product>
                    <table>
                        <independentVar lookup="row">systems/jt9d/engine[0]/epr-internal</independentVar>
                        <independentVar lookup="column">systems/jt9d/engine[0]/inlet-mach</independentVar>
                        <tableData>
                            0.0        0.1     0.2     0.3     0.4     0.5     0.6     0.7     0.8         0.9      1.00
                            0.75        0.00    0.00    0.00    0.00    0.00    2.89    14.92   33.52   49.67   59.08   65.61
                            0.80        0.00    0.00    0.00    0.00    3.41    18.78   33.84   50.14   60.04   66.72   71.22
                            0.90        0.00    0.00    0.00    18.62   35.93   49.68   60.39   67.78   72.96   76.02   78.71
                            1.00        24.15   32.07   36.81   51.09   60.05   67.33   72.95   77.63   80.58   82.73   83.66
                            1.25        78.84   79.53   80.33   82.25   84.85   87.46   89.71   91.07   91.76   91.63   91.79
                            1.30        83.03   83.61   84.29   85.56   87.85   90.07   91.97   93.04   93.46   93.33   93.43
                            1.40        89.14   89.28   89.82   91.18   92.96   94.73   95.92   96.53   96.57   96.53   96.63
                            1.50        94.02   93.92   94.32   95.54   96.98   98.69   99.34   99.46   99.46   99.46   99.65
                            1.55        95.82   95.78   96.40   97.49   98.84   100.36  100.76  100.98  100.95  100.95  100.95
                            1.57        97.56   97.57   98.15   99.42   100.65  101.83  102.24  102.16  102.29  102.36  102.41
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="systems/jt9d/engine[0]/tt6-thetak1">
            <function>
                <description>Corrected High pressure turbine discharge temperature (TT6/ThetaT1) deg K Figure 12.3-5</description>
                <product>
                    <table>
                        <independentVar lookup="row">systems/jt9d/engine[0]/epr</independentVar>
                        <independentVar lookup="column">systems/jt9d/engine[0]/inlet-mach</independentVar>
                        <tableData>
                            0    0.1     0.3     0.4     0.5     0.6     0.7     0.8     0.9     1
                            0.64        -425    -409    -118    36      3       213     349     429     469     539
                            0.70        -275    -259    4       148     145     327     444     523     605     687
                            0.80        -11     5       217     344     393     527     610     687     732     765
                            0.90        253     270     432     541     642     699     739     775     800     819
                            1.00        520     537     648     698     744     784     813     834     849     863
                            1.10        718     730     768     794     820     847     870     880     892     901
                            1.20        818     828     849     866     884     900     915     922     929     937
                            1.30        891     896     909     918     933     943     951     956     962     967
                            1.40        948     950     960     966     974     981     986     990     993     995
                            1.50        1001    1002    1008    1011    1012    1016    1016    1021    1021    1023
                            1.60        1047    1048    1046    1047    1048    1048    1051    1048    1048    1053
                            1.61        1050    1051    1048    1049    1053    1051    1053    1050    1050    1055
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="systems/jt9d/engine[0]/theta-t2">
            <function>
                <sum>
                    <value>1.0</value>
                    <product>
                        <value>0.2</value>
                        <property>systems/jt9d/engine[0]/inlet-mach</property>
                        <property>systems/jt9d/engine[0]/inlet-mach</property>
                    </product>
                </sum>
            </function>
        </fcs_function>

        <fcs_function name="systems/jt9d/engine[0]/nozzle-cmd-norm">
            <function>
                <description>PLA Vs Nozzle open area Figure 8, NASA-TM-104326 </description>
                <product>
                    <table>
                        <!--                        <independentVar lookup="row">fcs/throttle-cmd-norm[0] </independentVar> -->
                        <independentVar lookup="row">/controls/engines/engine[0]/throttle</independentVar>
                        <tableData>
                            0.0 	1.0000
                            0.10	0.26
                            0.97	0.26
                            1.00	1.0000
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>
        <kinematic name="systems/jt9d/engine[0]/nozzle-pos-norm">
            <input>systems/jt9d/engine[0]/nozzle-cmd-norm</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>1</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>1</time>
                </setting>
            </traverse>
        </kinematic>

        <fcs_function name="systems/jt9d/engine[0]/augmentation-pos">
            <function>
                <description>Augmentation factors</description>
                <product>
                    <table>
                        <independentVar lookup="row">/controls/engines/engine[0]/throttle</independentVar>
                        <tableData>
                            0	 0
                            0.98 0.00
                            1.00 1.00
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>

        <switch name="systems/jt9d/engine[0]/augmentation">
            <default value="0.0"/>
            <test value="systems/jt9d/engine[0]/augmentation-pos">
                /controls/engines/engine[0]/throttle ge 0.98
                systems/jt9d/engine[0]/nozzle-pos-norm eq 1
                systems/jt9d/engine[0]/n2 ge 97
            </test>
        </switch>


        <fcs_function name="systems/jt9d/engine[0]/n2">
            <function>
                <description>EPR ~ HPT RPM (N2)%</description>
                <product>
                    <table>
                        <independentVar lookup="row">systems/jt9d/engine[0]/epr-internal</independentVar>
                        <independentVar lookup="column">systems/jt9d/engine[0]/inlet-mach</independentVar>
                        <tableData>
                            0.0    0.1      0.3     0.4     0.5     0.6     0.7     0.8     0.9     1
                            1.00     50      51      62      67      71      75      77      79      81      82
                            1.10     68      69      73      76      78      81      83      84      85      86
                            1.20     78      79      81      82      84      86      87      88      88      89
                            1.30     85      85      87      87      89      90      91      91      92      92
                            1.40     90      90      91      92      93      93      94      94      95      95
                            1.45     95      95      96      96      96      97      97      97      97      97
                            1.50     100     100     100     100     100     100     100     100     100     100
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>
        <fcs_function name="systems/jt9d/engine[0]/tt6">
            <function>
                <product>
                    <property>systems/jt9d/engine[0]/tt6-thetak1</property>
                    <property>systems/jt9d/engine[0]/theta-t2</property>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="systems/jt9d/engine[0]/fn-factor">
            <function>
                <description>EPR ~ Installed generalized net thrust Figures 12.2-3, 12.2-4</description>
                <product>
                    <table>
                        <independentVar lookup="row">systems/jt9d/engine[0]/epr</independentVar>
                        <independentVar lookup="column">velocities/mach</independentVar>
                        <tableData>
                            0   	0.1 	0.2	    0.3	    0.4	    0.5	    0.6	    0.7	    0.8	    0.9	    1
                            0.705	0.000	0.000	0.000	0.000	0.000	0.000	0.000	0.000	0.000	0.000	0.069
                            0.790	0.000	0.000	0.000	0.000	0.000	0.000	0.000	0.000	0.064	0.115	0.182
                            0.920	0.000	0.000	0.000	0.000	0.000	0.048	0.130	0.183	0.235	0.283	0.332
                            1.000	0.000	0.021	0.055	0.085	0.126	0.170	0.232	0.277	0.329	0.376	0.416
                            1.104	0.281	0.260	0.250	0.253	0.277	0.315	0.357	0.395	0.441	0.483	0.526
                            1.204	0.489	0.430	0.398	0.398	0.403	0.430	0.459	0.498	0.537	0.574	0.612
                            1.306	0.659	0.583	0.539	0.527	0.518	0.531	0.552	0.586	0.621	0.661	0.701
                            1.401	0.797	0.718	0.664	0.631	0.620	0.615	0.632	0.661	0.698	0.736	0.783
                            1.501	0.924	0.832	0.771	0.731	0.711	0.698	0.709	0.734	0.773	0.815	0.870
                            1.577	0.998	0.899	0.833	0.789	0.768	0.754	0.766	0.792	0.834	0.881	0.940
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>


        <pure_gain name="systems/jt9d/engine[0]/ff-turbine-pph">
            <input>systems/jt9d/engine[0]/fn-lb</input>
            <gain>systems/jt9d/engine[0]/c-tsfc</gain>
            <output>systems/jt9d/engine[0]/ff-turbine-pph</output>
        </pure_gain>

        <fcs_function name="systems/jt9d/engine[0]/ff-augmentation-pph">
            <function>
                <product>
                    <property>systems/jt9d/engine[0]/fn-lb</property>
                    <property>systems/jt9d/engine[0]/c-atsfc-delta</property>
                    <property>systems/jt9d/engine[0]/augmentation</property>
                </product>
            </function>
        </fcs_function>


        <fcs_function name="systems/jt9d/engine[0]/fn-augmentation-lb">
            <function>
                <product>
                    <property>systems/jt9d/engine[0]/fn-factor</property>
                    <property>systems/jt9d/engine[0]/c-milthrust-lb</property>
                    <property>systems/jt9d/engine[0]/c-augthrust-factor</property>
                    <property>systems/jt9d/engine[0]/augmentation</property>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="systems/jt9d/engine[0]/fn-lb">
            <function>
                <sum>
                    <product>
                        <property>systems/jt9d/engine[0]/fn-factor</property>
                        <property>systems/jt9d/engine[0]/c-milthrust-lb</property>
                    </product>
                    <product>
                        <property>systems/jt9d/engine[0]/augmentation</property>
                        <property>systems/jt9d/engine[0]/fn-augmentation-lb</property>
                    </product>
                </sum>
                <output>systems/jt9d/engine[0]/fn-lb</output>
            </function>
        </fcs_function>


        <fcs_function name="systems/jt9d/engine[0]/tt9">
            <function>
                <product>
                    <property>systems/jt9d/engine[0]/ff-augmentation-pph</property>
                    <property>systems/jt9d/engine[0]/c-augmentation-to-egt</property>
                    <property>systems/jt9d/engine[0]/augmentation</property>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="systems/jt9d/engine[0]/egt-r">
            <function>
                <product>
                    <sum>
                        <property>systems/jt9d/engine[0]/tt6</property>
                        <property>systems/jt9d/engine[0]/tt9</property>
                    </sum>
                    <value>1.8</value>
                </product>
            </function>
        </fcs_function>

        <summer name="systems/jt9d/engine[0]/ff-total-pph">
            <input>systems/jt9d/engine[0]/ff-turbine-pph</input>
            <input>systems/jt9d/engine[0]/ff-augmentation-pph</input>
            <output>systems/jt9d/engine[0]/ff-total-pph</output>
        </summer>

        <lag_filter name="/engines/engine[0]/fuel-flow_pph">
            <input>systems/jt9d/engine[0]/ff-total-pph</input>
            <output>/engines/engine[0]/fuel-flow_pph</output>
            <c1> systems/jt9d/engine[0]/c-ff-lag </c1>
        </lag_filter>
        <lag_filter name="/engines/engine[1]/fuel-flow_pph">
            <input>systems/jt9d/engine[0]/ff-total-pph</input>
            <output>/engines/engine[1]/fuel-flow_pph</output>
            <c1> systems/jt9d/engine[0]/c-ff-lag </c1>
        </lag_filter>


        <pure_gain name="/engines/engine[0]/augmentation">
            <input>systems/jt9d/engine[0]/augmentation</input>
            <gain>1</gain>
        </pure_gain>

        <pure_gain name="/engines/engine[1]/augmentation">
            <input>systems/jt9d/engine[0]/augmentation</input>
            <gain>1</gain>
        </pure_gain>

        <pure_gain name="propulsion/engine[0]/n1">
            <input>systems/jt9d/engine[0]/n1</input>
            <gain>1</gain>
        </pure_gain>
        <pure_gain name="propulsion/engine[1]/n1">
            <input>systems/jt9d/engine[0]/n1</input>
            <gain>1</gain>
            <output>propulsion/engine[1]/n1</output>
        </pure_gain>

        <pure_gain name="propulsion/engine[1]/n2">
            <input>systems/jt9d/engine[0]/n2</input>
            <output>propulsion/engine[1]/n2</output>
            <gain>1</gain>
        </pure_gain>

        <pure_gain name="/engines/engine[0]/n1">
            <input>systems/jt9d/engine[0]/n1</input>
            <output>/engines/engine[0]/n1</output>
            <gain>1</gain>
        </pure_gain>

        <pure_gain name="/engines/engine[0]/n2">
            <input>systems/jt9d/engine[0]/n2</input>
            <output>/engines/engine[0]/n2</output>
            <gain>1</gain>
            <clipto>
                <min> 0 </min>
                <max>100</max>
            </clipto>
        </pure_gain>

        <pure_gain name="/engines/engine[1]/n1">
            <input>systems/jt9d/engine[0]/n1</input>
            <output>/engines/engine[1]/n1</output>
            <gain>1</gain>
        </pure_gain>
        <pure_gain name="/engines/engine[1]/n2">
            <input>systems/jt9d/engine[0]/n2</input>
            <output>/engines/engine[1]/n2</output>
            <gain>1</gain>
            <clipto>
                <min> 0 </min>
                <max>100</max>
            </clipto>
        </pure_gain>

        <lag_filter name="propulsion/engine[0]/EGT-R">
            <input>systems/jt9d/engine[0]/egt-r</input>
            <output>propulsion/engine[0]/EGT-R</output>
            <c1> systems/jt9d/engine[0]/c-egt-lag </c1>
        </lag_filter>
        <lag_filter name="propulsion/engine[1]/EGT-R">
            <input>systems/jt9d/engine[0]/egt-r</input>
            <output>propulsion/engine[0]/EGT-R</output>
            <c1> systems/jt9d/engine[0]/c-egt-lag </c1>
        </lag_filter>

        <pure_gain name="/engines/engine[0]/oil-pressure-psi">
            <input>systems/jt9d/engine[0]/n2</input>
            <output>/engines/engine[0]/oil-pressure-psi</output>
            <gain>0.53</gain>
        </pure_gain>
        <pure_gain name="/engines/engine[1]/oil-pressure-psi">
            <input>systems/jt9d/engine[0]/n2</input>
            <output>/engines/engine[1]/oil-pressure-psi</output>
            <gain>0.53</gain>
        </pure_gain>

        <pure_gain name="propulsion/engine[0]/nozzle-pos-norm">
            <input>systems/jt9d/engine[0]/nozzle-pos-norm</input>
            <output>propulsion/engine[0]/nozzle-pos-norm</output>
        </pure_gain>
        <pure_gain name="propulsion/engine[1]/nozzle-pos-norm">
            <input>systems/jt9d/engine[0]/nozzle-pos-norm</input>
            <output>propulsion/engine[1]/nozzle-pos-norm</output>
        </pure_gain>

        <summer name="external_reactions/F110-GE-400-1/magnitude">
            <input>-systems/jt9d/engine[0]/fn-lb</input>
            <output>external_reactions/F110-GE-400-1/magnitude</output>
        </summer>
        <summer name="external_reactions/F110-GE-400-2/magnitude">
            <input>-systems/jt9d/engine[0]/fn-lb</input>
            <output>external_reactions/F110-GE-400-2/magnitude</output>
        </summer>
    </channel>
</system>
